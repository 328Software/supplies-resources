<!--

-->
<project xmlns:ivy="antlib:org.apache.ivy.ant" name="common" basedir=".">
    <description>
        Common build scripts
    </description>
    <!--

        this build file is a self contained project:
        it requires ant 2.3 and java 1.7
    -->


    <!--
    -->
    <property file="local.properties"/>

    <!--
    -->
    <property name="data.basedir" value="${data.root}/${data.version}"/>
    <property name="badassgame.basedir" value="${badassgame.root}/${badassgame.version}"/>
    <property name="badengine.basedir" value="${badengine.root}/${badengine.version}"/>
    <property name="goodengine.basedir" value="${goodengine.root}/${goodengine.version}"/>

    <property name="repository" value="${basedir}/repository"/>

    <!--
    -->
    <property name="ivy.jar.dir" value="/ivy"/>
    <property name="ivy.jar.file" value="/ivy/ivy.jar"/>

    <target name="download-ivy" unless="skip.download">
        <mkdir dir="/ivy"/>
        <echo message="installing ivy..."/>
        <get src="http://repo1.maven.org/maven2/org/apache/ivy/ivy/${ivy.install.version}/ivy-${ivy.install.version}.jar" dest="${ivy.jar.file}" usetimestamp="true"/>
    </target>


    <!--
              target: install-ivy
                this target is not necessary if you put ivy.jar in your ant lib directory
    -->
    <target name="install-ivy" depends="download-ivy" description="--> install ivy">
        <!--
         try to load ivy here from local ivy dir, in case the user has not already dropped
                      it into ant's lib dir (note that the latter copy will always take precedence).
                      We will not fail as long as local lib dir exists (it may be empty) and
                      ivy is in at least one of ant's lib dir or the local lib dir.
        -->
        <path id="ivy.lib.path">
            <fileset dir="/ivy" includes="*.jar"/>
        </path>
        <taskdef resource="org/apache/ivy/ant/antlib.xml" uri="antlib:org.apache.ivy.ant" classpathref="ivy.lib.path"/>
    </target>


    <target name="clean-repository" description="--> clean the local repository">
        <delete includeemptydirs="true" failonerror="false">
            <fileset dir="${repository}" includes="**/*"/>
        </delete>
    </target>

    <target name="update-repository" depends="install-ivy,clean-repository" description="--> retrieve dependencies with ivy">
        <mkdir dir="${repository}"/>
        <ivy:retrieve pattern="${repository}/[module]/[artifact]-[type]-[revision].[ext]"
                      ivypattern="${repository}/[module]/[revision]/[artifact].[ext]"
                      conf="*"/>
    </target>

</project>